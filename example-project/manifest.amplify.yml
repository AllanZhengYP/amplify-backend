version: '~4.7.2'
resources:
  testFileStorage:
    provider: s3Provider
    definition:
      enableSSL: true
    triggers:
      stream: s3StreamHandler
  s3StreamHandler:
    provider: lambdaProvider
    definition:
      runtime: $param:functionRuntime
      timeoutSeconds: 200
      handler: index.handler
      relativeBuildAssetPath: ./testLambda
      env:
        SERVER_TIMEOUT: $param:serverTimeout
    preSynthCommand: cd ./testLambda && npx tsc
    secrets:
      DB_PASSWORD: $secret:databasePassword
    runtimeAccess:
      lambdaRuntime:
        blogTable:
          - actions: [create, read, update, delete]
  testGqlApi:
    provider: appSyncProvider
    definition:
      relativeSchemaPath: ./schema.graphql
    managedTables:
      - blogTable
  blogTable:
    provider: dynamoDbProvider
    definition:
      streamEnabled: true
parameters:
  - functionRuntime
  - serverTimeout
secrets:
  - databasePassword
providers:
  dynamoDbProvider: '@aws-amplify/dynamo-db-provider@2.3.4'
  s3Provider: '@aws-amplify/s3-provider@1.2.3'
  lambdaProvider: '@aws-amplify/lambda-provider@4.5.6'
  appSyncProvider: '@aws-amplify/app-sync-provider@10.2.3'
